# Story 2.1: Create Workout

## Status

Draft

## Story

**As a** developer,
**I want** a `POST /workouts` endpoint,
**so that** a client application can create a new `Workout` for a user on a specific date.

## Acceptance Criteria

1.  A `POST` request to `/workouts` with a valid `date` in the request body creates a new `Workout` record in the database.
2.  The `user_id` for the new workout must be derived from the authenticated user's JWT token. The endpoint must be protected.
3.  The endpoint can optionally accept a `name` and `notes` for the workout.
4.  A successful request returns a `201 Created` HTTP status code and the newly created `Workout` object.
5.  A user cannot have more than one `Workout` for the same `date`. If a workout for that user and date already exists, the endpoint should return a `409 Conflict` status code.

## Tasks / Subtasks

*   `[ ]` **Task 1: Create Pydantic models for workout creation.** (AC: #1, #3)
    *   `[ ]` Subtask 1.1: Create a `WorkoutCreate` model for the request body with `date`, and optional `name` and `notes` fields.
    *   `[ ]` Subtask 1.2: Create a `WorkoutRead` model for the response.
*   `[ ]` **Task 2: Implement the `/workouts` router and endpoint.** (AC: #1, #2, #5)
    *   `[ ]` Subtask 2.1: Create a new router file in `apps/api/routers/workouts.py`.
    *   `[ ]` Subtask 2.2: Define the `POST /workouts` endpoint.
    *   `[ ]` Subtask 2.3: Protect the endpoint using the `get_current_user` dependency.
*   `[ ]` **Task 3: Implement the workout creation service and repository logic.** (AC: #1, #5)
    *   `[ ]` Subtask 3.1: Create a `WorkoutService` to contain the business logic.
    *   `[ ]` Subtask 3.2: The service must check if a workout already exists for that user and date in the `WorkoutRepository` before creating a new one.
    *   `[ ]` Subtask 3.3: Create a `WorkoutRepository` with `create_workout` and `get_by_user_and_date` methods.
*   `[ ]` **Task 4: Write tests for the workout creation endpoint.**
    *   `[ ]` Subtask 4.1: Write integration tests covering the success case (201), the conflict case (409), and the unauthorized case (401).

## Dev Notes

*   **Naming:** The data model previously called `WorkoutSession` is now named `Workout`. All related variables, files, and classes should reflect this (e.g., `workoutId`, `workouts.py`, `WorkoutRepository`).
*   **Authentication:** This is a protected endpoint. It must use the `get_current_user` dependency created in Story 1.2 to identify the user creating the workout.
*   **Conflict Handling:** The business logic must prevent a user from having two `Workout` records on the same date. The service layer should query for an existing workout before attempting to create a new one.
*   **Repository:** The `WorkoutRepository` should handle all direct database interactions for the `workouts` table.

## Change Log

| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2025-09-23 | 1.0 | Initial draft | Sarah |
