# Story 2.3: List Workouts

## Status

Draft

## Story

**As a** developer,
**I want** a `GET /workouts` endpoint,
**so that** a client application can retrieve a list of all `Workouts` for the authenticated user, allowing for pagination.

## Acceptance Criteria

1.  A `GET` request to `/workouts` returns a `200 OK` status code with a list of `Workout` objects belonging to the authenticated user.
2.  The endpoint must be protected, returning a `401 Unauthorized` if no valid JWT is provided.
3.  The returned list of workouts must be sorted by `date` in descending order (most recent first).
4.  The endpoint must support pagination using `limit` and `offset` query parameters. `limit` should default to a reasonable number (e.g., 20).
5.  The response body should be a JSON object containing the list of workouts and pagination metadata (e.g., `total_count`, `limit`, `offset`).
6.  If the user has no workouts, the endpoint should return a `200 OK` with an empty list.

## Tasks / Subtasks

*   `[ ]` **Task 1: Create Pydantic models for the paginated response.** (AC: #5)
    *   `[ ]` Subtask 1.1: Create a `PaginatedWorkoutResponse` model that includes a list of `WorkoutRead` models and fields for `total_count`, `limit`, and `offset`.
*   `[ ]` **Task 2: Implement the `GET /workouts` endpoint.** (AC: #1, #2, #4)
    *   `[ ]` Subtask 2.1: Add the new `GET` endpoint to the `apps/api/routers/workouts.py` router.
    *   `[ ]` Subtask 2.2: Implement `limit` and `offset` as query parameters with default values.
    *   `[ ]` Subtask 2.3: Ensure the endpoint is protected by the `get_current_user` dependency.
*   `[ ]` **Task 3: Implement the service and repository logic for fetching workouts.** (AC: #1, #3, #6)
    *   `[ ]` Subtask 3.1: Create a `get_workouts` method in the `WorkoutService`.
    *   `[ ]` Subtask 3.2: Create a `list_by_user` method in the `WorkoutRepository` that accepts `user_id`, `limit`, and `offset`.
    *   `[ ]` Subtask 3.3: The repository method must perform a query to fetch the paginated list of workouts, ordered by date descending, and another query to get the total count for that user.
*   `[ ]` **Task 4: Write tests for the list workouts endpoint.**
    *   `[ ]` Subtask 4.1: Write an integration test to verify that the endpoint returns a correctly sorted and paginated list of workouts for an authenticated user.
    *   `[ ]` Subtask 4.2: Write a test to verify that a user only sees their own workouts.
    *   `[ ]` Subtask 4.3: Write a test for the case where a user has zero workouts.
    *   `[ ]` Subtask 4.4: Write a test to ensure the endpoint returns a `401 Unauthorized` error for unauthenticated requests.

## Dev Notes

*   **Pagination in Repository:** When implementing the `list_by_user` method in the `WorkoutRepository`, use SQLAlchemy/SQLModel's chainable query methods: `.order_by(models.Workout.date.desc())`, `.offset(offset)`, and `.limit(limit)`.
*   **Count Query:** To get the `total_count` for the pagination metadata, perform a separate, more efficient `count()` query on the table for that user, rather than fetching all records into memory.
*   **Response Model:** Use the new `PaginatedWorkoutResponse` model in the `@router.get` decorator's `response_model` argument to ensure the API response conforms to the defined schema and is documented correctly.
*   **Dependencies:** This story relies on the functionality from Story 2.1 (`create-workout`) to have data to list. The tests for this story should first create some workout data to query.

## Change Log

| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2025-09-23 | 1.0 | Initial draft | Sarah |
