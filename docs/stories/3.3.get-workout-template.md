# Story 3.3: Get Workout Template

## Status

Draft

## Story

**As a** developer,
**I want** a `GET /workout-templates/{template_id}` endpoint,
**so that** a client application can retrieve the full, detailed structure of a single `WorkoutTemplate`.

## Acceptance Criteria

1.  A `GET` request to `/workout-templates/{template_id}` returns a `200 OK` status code with the full `WorkoutTemplate` object, including its nested `activities` structure.
2.  The endpoint must be protected, returning a `401 Unauthorized` if the user is not authenticated.
3.  If the `template_id` does not exist, the endpoint must return a `404 Not Found`.
4.  If the authenticated user is not the owner of the requested template, the endpoint must return a `403 Forbidden`.

## Tasks / Subtasks

*   `[ ]` **Task 1: Implement the `GET /workout-templates/{template_id}` endpoint.** (AC: #1, #2)
    *   `[ ]` Subtask 1.1: Add the new `GET` endpoint with a `template_id` path parameter to the `apps/api/routers/workout_templates.py` router.
    *   `[ ]` Subtask 1.2: Ensure the endpoint is protected by the `get_current_user` dependency.
*   `[ ]` **Task 2: Implement the service and repository logic.** (AC: #1, #3, #4)
    *   `[ ]` Subtask 2.1: Create a `get_template_details` method in the `WorkoutTemplateService`.
    *   `[ ]` Subtask 2.2: The service must first fetch the template from the `WorkoutTemplateRepository` to verify its existence and ownership.
    *   `[ ]` Subtask 2.3: Create a `get_by_id` method in the `WorkoutTemplateRepository` that fetches a single template by its ID.
*   `[ ]` **Task 3: Write tests for the get template details endpoint.**
    *   `[ ]` Subtask 3.1: Write an integration test for the success case (200), ensuring the full nested `activities` structure is returned correctly.
    *   `[ ]` Subtask 3.2: Write tests for the failure cases: `404 Not Found`, `403 Forbidden`, and `401 Unauthorized`.

## Dev Notes

*   **Authorization:** The authorization check is the most critical part of the service logic. The service must fetch the template and verify that its `user_id` matches the ID of the authenticated user before returning any data.
*   **JSONB Deserialization:** When you fetch the `WorkoutTemplate` from the database, the `activities` column will be raw JSON. SQLModel will automatically deserialize this JSON back into your nested Pydantic models (`ActivityGroup`, `WorkoutTemplateItem`, etc.) when you populate the `WorkoutTemplateRead` response model.
*   **Dependencies:** The tests for this story will need to create a user and a workout template first, in order to have a template to fetch.

## Change Log

| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2025-09-23 | 1.0 | Initial draft | Sarah |
