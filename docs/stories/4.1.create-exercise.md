# Story 4.1: Create Exercise

## Status

Draft

## Story

**As a** developer,
**I want** a `POST /exercises` endpoint,
**so that** a user can create and save their own custom exercise definitions.

## Acceptance Criteria

1.  A `POST` request to `/exercises` with a valid `name`, `description` (optional), and `type` (e.g., `STRENGTH_REPS`, `HANGBOARD`) in the request body successfully creates a new `Exercise` record in the database.
2.  The `user_id` for the new exercise must be derived from the authenticated user's JWT token. The endpoint must be protected.
3.  A successful request returns a `201 Created` HTTP status code and the newly created `Exercise` object.
4.  A `POST` request using a `name` that already exists for that specific user (i.e., a user cannot have two custom exercises with the same name) must fail with a `409 Conflict` HTTP status code and a clear error message.
5.  A `POST` request with an invalid `type` or missing required fields must fail with a `422 Unprocessable Entity` HTTP status code and details about the validation errors.

## Tasks / Subtasks

*   `[ ]` **Task 1: Create Pydantic models for exercise creation.** (AC: #1, #5)
    *   `[ ]` Subtask 1.1: Create an `ExerciseCreate` model for the request body with `name`, `description` (optional), and `type`.
    *   `[ ]` Subtask 1.2: Create an `ExerciseRead` model for the response.
*   `[ ]` **Task 2: Implement the `POST /exercises` router and endpoint.** (AC: #1, #2)
    *   `[ ]` Subtask 2.1: Create a new router file in `apps/api/routers/exercises.py`.
    *   `[ ]` Subtask 2.2: Define the `POST /exercises` endpoint, ensuring it is protected by the `get_current_user` dependency.
*   `[ ]` **Task 3: Implement the exercise creation service and repository logic.** (AC: #1, #4)
    *   `[ ]` Subtask 3.1: Create an `ExerciseService` to contain the business logic.
    *   `[ ]` Subtask 3.2: The service must check if an exercise with the same name already exists for that user before creating a new one.
    *   `[ ]` Subtask 3.3: Create an `ExerciseRepository` with `create_exercise` and `get_by_user_and_name` methods.
*   `[ ]` **Task 4: Write tests for the exercise creation endpoint.**
    *   `[ ]` Subtask 4.1: Write an integration test for a successful creation (201).
    *   `[ ]` Subtask 4.2: Write integration tests for the conflict case (409) and validation error case (422).
    *   `[ ]` Subtask 4.3: Write a test for the unauthorized case (401).

## Dev Notes

*   **Unique Constraint:** The database schema already includes a `UNIQUE(user_id, name)` constraint on the `exercises` table. The service layer should handle the `409 Conflict` by attempting to retrieve an existing exercise with the same name for the user before creating a new one.
*   **System-Defined Exercises:** For now, this story focuses on user-created exercises. System-defined exercises (where `user_id` is `NULL`) will be managed separately, possibly through database seeding or a different API.
*   **Pydantic `ExerciseType`:** Ensure the `type` field uses the `ExerciseType` enum (or equivalent Pydantic `Literal` type) to enforce valid exercise types.
*   **Dependencies:** This story requires a user to be authenticated, so it depends on the authentication functionality from Epic 1.

## Change Log

| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2025-09-23 | 1.0 | Initial draft | Sarah |
