# Story 4.3: Get Exercise Details

## Status

Draft

## Story

**As a** developer,
**I want** a `GET /exercises/{exercise_id}` endpoint,
**so that** a client application can retrieve the full details of a single `Exercise` definition.

## Acceptance Criteria

1.  A `GET` request to `/exercises/{exercise_id}` returns a `200 OK` status code with the full `Exercise` object.
2.  The endpoint must be protected, returning a `401 Unauthorized` if the user is not authenticated.
3.  If the `exercise_id` does not exist, the endpoint must return a `404 Not Found`.
4.  If the `exercise_id` exists but is not a system-defined exercise AND is not owned by the authenticated user, the endpoint must return a `403 Forbidden`.

## Tasks / Subtasks

*   `[ ]` **Task 1: Implement the `GET /exercises/{exercise_id}` endpoint.** (AC: #1, #2)
    *   `[ ]` Subtask 1.1: Add the new `GET` endpoint with an `exercise_id` path parameter to the `apps/api/routers/exercises.py` router.
    *   `[ ]` Subtask 1.2: Ensure the endpoint is protected by the `get_current_user` dependency.
*   `[ ]` **Task 2: Implement the service and repository logic for fetching an exercise.** (AC: #1, #3, #4)
    *   `[ ]` Subtask 2.1: Create a `get_exercise_details` method in the `ExerciseService`.
    *   `[ ]` Subtask 2.2: Create a `get_by_id_and_user_or_system` method in the `ExerciseRepository`. This method should fetch an exercise by ID and verify if it's either system-defined (`user_id IS NULL`) or owned by the provided `user_id`.
*   `[ ]` **Task 3: Write tests for the get exercise details endpoint.**
    *   `[ ]` Subtask 3.1: Write an integration test for a successful request for a system-defined exercise.
    *   `[ ]` Subtask 3.2: Write an integration test for a successful request for a user-owned exercise.
    *   `[ ]` Subtask 3.3: Write tests for the failure cases: `404 Not Found`, `403 Forbidden`, and `401 Unauthorized`.

## Dev Notes

*   **Authorization Logic:** The `get_by_id_and_user_or_system` method in the `ExerciseRepository` (or the `ExerciseService`) is critical. It must perform a query that checks for an exercise matching the `exercise_id` where either `user_id IS NULL` (system-defined) OR `user_id = authenticated_user_id`. If an exercise is found but does not meet these criteria, it should be treated as a `403 Forbidden`.
*   **Error Handling:** Ensure that `ItemNotFoundException` (for 404) and `ForbiddenException` (for 403) are raised appropriately from the service layer.
*   **Dependencies:** For testing, you will need to seed the database with some system-defined exercises and create some user-defined exercises.

## Change Log

| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2025-09-23 | 1.0 | Initial draft | Sarah |
